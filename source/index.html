<!--
/*******************************************************************************
#      ____               __          __  _      _____ _       _               #
#     / __ \              \ \        / / | |    / ____| |     | |              #
#    | |  | |_ __   ___ _ __ \  /\  / /__| |__ | |  __| | ___ | |__   ___      #
#    | |  | | '_ \ / _ \ '_ \ \/  \/ / _ \ '_ \| | |_ | |/ _ \| '_ \ / _ \     #
#    | |__| | |_) |  __/ | | \  /\  /  __/ |_) | |__| | | (_) | |_) |  __/     #
#     \____/| .__/ \___|_| |_|\/  \/ \___|_.__/ \_____|_|\___/|_.__/ \___|     #
#           | |                                                                #
#           |_|                 _____ _____  _  __                             #
#                              / ____|  __ \| |/ /                             #
#                             | (___ | |  | | ' /                              #
#                              \___ \| |  | |  <                               #
#                              ____) | |__| | . \                              #
#                             |_____/|_____/|_|\_\                             #
#                                                                              #
#                              (c) 2011-2012 by                                #
#           University of Applied Sciences Northwestern Switzerland            #
#                     Institute of Geomatics Engineering                       #
#                          Author:robert.wst@gmail.com                         #
********************************************************************************
*     Licensed under MIT License. Read the file LICENSE for more information   *
*******************************************************************************/
                      GeoGame: Prototype
*******************************************************************************/-->
<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../../WebViewer/compiled/owg-optimized.js"></script>
    <script type="text/javascript" src="kineticjs.js"></script>
    <script type="text/javascript" src="fx.js"></script>
    <script type="text/javascript" src="ui.js"></script>
    <script type="text/javascript" src="main.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body style="overflow:hidden;" onload="Init()">
<div id="main_div" class="main_div">
</div>
<div id="owg_div" class="owg_div">
    <canvas id="canvas" class="canvas">

    </canvas>
</div>

<script type="text/javascript">
    //ogSetArtworkDirectory("../../WebViewer/art/");

    /* Members */
    var m_images = {};
    var m_loadedImages = 0;
    var m_numImages = 0;
    var m_context = ogCreateContextFromCanvas("canvas", true);
    var m_globe = ogCreateGlobe(m_context);
    var m_stage = new Kinetic.Stage("main_div", window.innerWidth, window.innerHeight);
    var m_ui = new Kinetic.Layer();
    var m_static = new Kinetic.Layer();
    var m_centerX = window.innerWidth/2;
    var m_centerY = window.innerHeight/2;
    var m_lang = "de";
    var m_locale = [];
    var m_game = null;
    var m_player = null;
    var m_clock = null;
    var m_score = null;
    var m_poilayer = null;


    /* preload functions */
    function LoadImages(sources){
        // get num of sources
        for (var src in sources) {
            m_numImages++;
        }
        for (var src in sources) {
            m_images[src] = new Image();
            /*m_images[src].onload = function(){
                if (++m_loadedImages >= m_numImages) {
                    callback(images);
                }
            };*/
            m_images[src].src = sources[src];
        }
    }
    function LoadLanguage(callback)
    {
        jQuery.getJSON('../data/lang_'+m_lang+'.json', function(data) {
            m_locale = data;
            callback();
        });
    }

    /* init game */
    function Init() {
        // Preload images
        var sources = {
            btn_01: "../art/btn_01.png",
            btn_01_c: "../art/btn_01_c.png",
            btn_01_h: "../art/btn_01_h.png",
            btn_01_d: "../art/btn_01_d.png",
            btn_01_f: "../art/btn_01_f.png",
            btn_01_t: "../art/btn_01_t.png",
            btn_01_o: "../art/btn_01_o.png",
            clock: "../art/clock.png",
            dial: "../art/dial.png",
            pin_blue: "../art/pin_blue.png",
            pin_red: "../art/pin_red.png",
            pin_green: "../art/pin_green.png",
            pin_yellow: "../art/pin_yellow.png"
        };
        LoadImages(sources);
        LoadLanguage(function()
        {
            var startMessage = new MessageDialog(m_ui, m_locale.start, 500, 250);
            startMessage.RegisterCallback(function(){
                m_ui.setAlpha(0.0);
                m_game.Init();
            });
        });
        // Add OWG Data
        ogAddImageLayer(m_globe, {
            url: ["http://www.openwebglobe.org/data/img"],
            layer: "World500",
            service: "i3d"
        });
        ogAddImageLayer(m_globe, {
            url: ["http://10.42.2.37"],
            layer: "swissimage",
            service: "owg"
        });
        /*ogAddImageLayer(m_globe, {
            url: ["http://10.42.2.37"],
            layer: "ch_boundaries",
            service: "owg"
        });*/
        ogAddElevationLayer(m_globe, {
            url: ["http://10.42.2.37"],
            layer: "DHM25",
            service: "owg"
        });

        m_poilayer = ogCreatePOILayer(m_globe,"misc");

        ogSetRenderFunction(m_context, OnRender);
        ogSetResizeFunction(m_context, OnResize);

        m_stage.add(m_static);
        m_stage.add(m_ui);
        m_stage.onFrame(function(frame){
            OnCanvasRender(frame);
        });
        m_stage.start();

        var myGameData = new GameData();
        m_game = new GlobeGame(myGameData);

    }

    /* Render Callback */
    function OnCanvasRender(frame)
    {
        m_stage.draw();
        if(m_game)
        {
            m_game.CycleCallback();
        }
    }

    function OnRender(context)
    {

    }

    function OnResize(context)
    {
        m_stage.setSize(window.innerWidth, window.innerHeight);
        m_centerX = window.innerWidth/2;
        m_centerY = window.innerHeight/2;
    }

    /* event callbacks */
</script>
</body>
</html>
