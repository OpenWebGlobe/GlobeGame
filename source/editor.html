<!--
/*******************************************************************************
#      ____               __          __  _      _____ _       _               #
#     / __ \              \ \        / / | |    / ____| |     | |              #
#    | |  | |_ __   ___ _ __ \  /\  / /__| |__ | |  __| | ___ | |__   ___      #
#    | |  | | '_ \ / _ \ '_ \ \/  \/ / _ \ '_ \| | |_ | |/ _ \| '_ \ / _ \     #
#    | |__| | |_) |  __/ | | \  /\  /  __/ |_) | |__| | | (_) | |_) |  __/     #
#     \____/| .__/ \___|_| |_|\/  \/ \___|_.__/ \_____|_|\___/|_.__/ \___|     #
#           | |                                                                #
#           |_|                 _____ _____  _  __                             #
#                              / ____|  __ \| |/ /                             #
#                             | (___ | |  | | ' /                              #
#                              \___ \| |  | |  <                               #
#                              ____) | |__| | . \                              #
#                             |_____/|_____/|_|\_\                             #
#                                                                              #
#                              (c) 2011-2012 by                                #
#           University of Applied Sciences Northwestern Switzerland            #
#                     Institute of Geomatics Engineering                       #
#                          Author:robert.wst@gmail.com                         #
********************************************************************************
*     Licensed under MIT License. Read the file LICENSE for more information   *
*******************************************************************************/
                      GeoGame: Prototype
*******************************************************************************/-->
<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../../WebViewer/compiled/owg-optimized.js"></script>
    <script type="text/javascript" src="kineticjs.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body style="overflow:hidden;" onload="Init()">
<div id="owg_div" >
    <div style="background-color:#FFF;position:absolute; width: 100%;height: 200px; bottom: 0px">
        <input type="button" style="width:100px; height: 25px" value="Add View" onclick="AddView()"/><br/>
        Current:<br/>
        <span id="current"></span><br/>
        Output:<br/>
        <textarea id="output" style="width: 100%; height: 90px"></textarea>
    </div>
            <canvas id="canvas">

            </canvas>
        </div>
<script type="text/javascript">


    ogSetArtworkDirectory("../../WebViewer/art/");

    /* Members */
    var m_images = {};
    var m_loadedImages = 0;
    var m_numImages = 0;
    var m_context = ogCreateContextFromCanvas("canvas", true);
    var m_globe = ogCreateGlobe(m_context);


    /* preload functions */
    function LoadImages(sources){
        // get num of sources
        for (var src in sources) {
            m_numImages++;
        }
        for (var src in sources) {
            m_images[src] = new Image();
            /*m_images[src].onload = function(){
             if (++m_loadedImages >= m_numImages) {
             callback(images);
             }
             };*/
            m_images[src].src = sources[src];
        }
    }


    /* init game */
    function Init() {
        // Preload images
        var sources = {

        };
        LoadImages(sources);

        // Add OWG Data
         ogAddImageLayer(m_globe, {
         url: ["http://www.openwebglobe.org/data/img"],
         layer: "World500",
         service: "i3d"
         });
         ogAddImageLayer(m_globe, {
         url: ["http://10.42.2.37"],
         layer: "swissimage",
         service: "owg"
         });
         ogAddElevationLayer(m_globe, {
         url: ["http://10.42.2.37"],
         layer: "DHM25",
         service: "owg"
         });
        ogSetRenderFunction(m_context, OnRender);
        ogSetResizeFunction(m_context, OnResize);
    }

    function ViewObj(long,lat,elev,yaw,pitch,roll){
        this.longitude = long;
        this.latitude = lat;
        this.elevation = elev;
        this.yaw = yaw;
        this.pitch = pitch;
        this.roll = roll;
    }

    var m_views = [];

    function AddView()
    {
        var scene = ogGetScene(m_context);
        var ori = ogGetOrientation(scene);
        var pos = ogGetPosition(scene);
        var view = new ViewObj(pos["longitude"],pos["latitude"],pos["elevation"],ori["yaw"],ori["pitch"],ori["roll"]);
        m_views.push(view);

    }


    function OnRender(context)
    {
        var scene = ogGetScene(m_context);
        var ori = ogGetOrientation(scene);
        var pos = ogGetPosition(scene);
        document.getElementById('current').innerText = "yaw="+ori["yaw"]+" pitch="+ori["pitch"]+" roll="+ori["roll"]+"\n" +
                "lng="+pos["longitude"]+" lat="+pos["latitude"]+" elev="+pos["elevation"];
        var out = "";
        for(var i = 0; i<m_views.length; i++){
            out = out + "{ \"longitude\": "+m_views[i].longitude+",\n \"latitude\": "+m_views[i].latitude+",\n \"elevation\": "+m_views[i].elevation+",\n " +
                    "\"yaw\": "+m_views[i].yaw+",\n \"pitch\": "+m_views[i].pitch+",\n \"roll\": "+m_views[i].roll+"\n }";
            if(i < m_views.length -1)
            {
                out = out + ",\n";
            }
        }

        document.getElementById('output').innerHTML = "[\n"+out+"\n]";
    }

    function OnResize(context)
    {
        m_centerX = window.innerWidth/2;
        m_centerY = window.innerHeight/2;
    }



</script>
</body>
</html>
