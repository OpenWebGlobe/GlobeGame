<!--
/*******************************************************************************
#      ____               __          __  _      _____ _       _               #
#     / __ \              \ \        / / | |    / ____| |     | |              #
#    | |  | |_ __   ___ _ __ \  /\  / /__| |__ | |  __| | ___ | |__   ___      #
#    | |  | | '_ \ / _ \ '_ \ \/  \/ / _ \ '_ \| | |_ | |/ _ \| '_ \ / _ \     #
#    | |__| | |_) |  __/ | | \  /\  /  __/ |_) | |__| | | (_) | |_) |  __/     #
#     \____/| .__/ \___|_| |_|\/  \/ \___|_.__/ \_____|_|\___/|_.__/ \___|     #
#           | |                                                                #
#           |_|                 _____ _____  _  __                             #
#                              / ____|  __ \| |/ /                             #
#                             | (___ | |  | | ' /                              #
#                              \___ \| |  | |  <                               #
#                              ____) | |__| | . \                              #
#                             |_____/|_____/|_|\_\                             #
#                                                                              #
#                              (c) 2011-2012 by                                #
#           University of Applied Sciences Northwestern Switzerland            #
#                     Institute of Geomatics Engineering                       #
#                          Author:robert.wst@gmail.com                         #
********************************************************************************
*     Licensed under MIT License. Read the file LICENSE for more information   *
*******************************************************************************/
                      GeoGame: Prototype
*******************************************************************************/-->
<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../../WebViewer/compiled/owg-optimized.js"></script>
    <script type="text/javascript" src="kineticjs.js"></script>
    <script type="text/javascript" src="main.js"></script>
    <script type="text/javascript" src="fx.js"></script>
    <script type="text/javascript" src="ui.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body style="overflow:hidden;" onload="Init()">
<div id="owg_div" style="float:left">
    <div id="main_ui" style="position: absolute;  width: 100%;height: 100%; z-index: 100; visibility: hidden"></div>
    <canvas id="canvas">

    </canvas>
</div>
<div style="background-color:#FFF;position:absolute; width: 350px; padding:5px; z-index: 101; float:right; right:0px">
    <h2>OWG Spiel: Challenge Editor</h2><br/>
    <input class="edbutton" type="button" style="width:150px; height: 25px" value="Test" onclick="ShowChallenge()"/>
    <input class="edbutton" type="button" style="width:150px; height: 25px" value="Reset" onclick="HideChallenge()"/>
    <b>Details:</b><br/>
    <table>
        <tr>
            <td>Antwort 1: </td><td><input id="option1" type="text" value="Option1"/></td>
        </tr>
        <tr>
            <td>Antwort 2: </td><td><input id="option2" type="text" value="Option2"/></td>
        </tr>
        <tr>
            <td>Antwort 3: </td><td><input id="option3" type="text" value="Option3"/></td>
        </tr>
        <tr>
            <td>Antwort 4: </td><td><input id="option4" type="text" value="Option4"/></td>
        </tr>
        <tr>
            <td>L&ouml;sungsantwort(1-4): </td><td><input id="correctoption" type="number" value="1"/></td>
        </tr>
        <tr>
            <td>Punkte: </td><td><input id="basescore" type="number" value="100"/></td>
        </tr>
        <tr>
            <td>Beschreibung: </td><td><input id="title" type="text" value="Test Title" /></td>
        </tr>
    </table>
    <b>Ansichten verwalten:</b><br/>
    <input class="edbutton" type="button" style="width:150px; height: 25px" value="Hinzuf&uuml;gen" onclick="AddView()"/><input class="edbutton" type="button" style="width:150px; height: 25px" value="Leeren" onclick="ClearViews()"/>
    <br/>Current:<span id="current"></span><br/>
    <b>Ausgabe:</b><br/>
    <textarea id="output" style="height:400px; width: 350px" onclick="SelectAllText('output')"></textarea>
</div>


<script type="text/javascript">
    ogSetArtworkDirectory("../../WebViewer/art/");
    function SelectAllText(id)
    {
        document.getElementById(id).focus();
        document.getElementById(id).select();
    }

    /* Members */
    var m_images = {};
    var m_loadedImages = 0;
    var m_numImages = 0;
    var m_context = ogCreateContextFromCanvas("canvas", true);
    var m_globe = ogCreateGlobe(m_context);
    var m_stage = new Kinetic.Stage("main_ui", window.innerWidth, window.innerHeight);
    var m_ui = new Kinetic.Layer();
    var m_centerX = (window.innerWidth-350)/2;
    var m_centerY = window.innerHeight/2;
    var challenge = null;

    /* preload functions */
    function LoadImages(sources){
        // get num of sources
        for (var src in sources) {
            m_numImages++;
        }
        for (var src in sources) {
            m_images[src] = new Image();
            /*m_images[src].onload = function(){
             if (++m_loadedImages >= m_numImages) {
             callback(images);
             }
             };*/
            m_images[src].src = sources[src];
        }
    }


    /* init game */
    function Init() {
        // Preload images
        var sources = {
            btn_01: "../art/btn_01.png",
            btn_01_c: "../art/btn_01_c.png",
            btn_01_h: "../art/btn_01_h.png",
            btn_01_d: "../art/btn_01_d.png",
            btn_01_f: "../art/btn_01_f.png",
            btn_01_t: "../art/btn_01_t.png",
            btn_01_o: "../art/btn_01_o.png",
            clock: "../art/clock.png",
            dial: "../art/dial.png"
        };
        LoadImages(sources);

        // Add OWG Data
         ogAddImageLayer(m_globe, {
         url: ["http://www.openwebglobe.org/data/img"],
         layer: "World500",
         service: "i3d"
         });
         ogAddImageLayer(m_globe, {
         url: ["http://10.42.2.37"],
         layer: "swissimage",
         service: "owg"
         });
         ogAddElevationLayer(m_globe, {
         url: ["http://10.42.2.37"],
         layer: "DHM25",
         service: "owg"
         });
        ogSetRenderFunction(m_context, OnRender);
        ogSetResizeFunction(m_context, OnResize);
        var scene = ogGetScene(m_context);
        ogSetCanvasSizeOffset(scene, 360, 1);
        m_stage.add(m_ui);
        m_stage.onFrame(function(frame){
            OnCanvasRender(frame);
        });
        m_stage.start();
    }

    function ViewObj(long,lat,elev,yaw,pitch,roll){
        this.longitude = long;
        this.latitude = lat;
        this.elevation = elev;
        this.yaw = yaw;
        this.pitch = pitch;
        this.roll = roll;
    }

    var m_views = [];

    function AddView()
    {
        var scene = ogGetScene(m_context);
        var ori = ogGetOrientation(scene);
        var pos = ogGetPosition(scene);
        var view = new ViewObj(pos["longitude"],pos["latitude"],pos["elevation"],ori["yaw"],ori["pitch"],ori["roll"]);
        m_views.push(view);

    }

    function Update()
    {
        var val = jQuery.parseJSON(document.getElementById('output').innerHTML);
        challenge = new LandmarkChallenge(val.BaseScore, val.Options, val.CorrectOption, val.Views, val.Title);
        challenge.Activate();
    }

    function ClearViews()
    {
        alert("bla");
        m_views = [];
    }

    function ShowChallenge()
    {
        jQuery('#main_ui').css("visibility", "visible");
        Update();
    }

    function HideChallenge()
    {
        challenge.Destroy();
        setTimeout(function(){
            jQuery('#main_ui').css("visibility", "hidden");},1000);
    }

    /* Render Callback */
    function OnCanvasRender(frame)
    {
        m_stage.draw();
    }

    function OnRender(context)
    {
        var scene = ogGetScene(m_context);
        var ori = ogGetOrientation(scene);
        var pos = ogGetPosition(scene);
        document.getElementById('current').innerText = "yaw="+ori["yaw"]+" pitch="+ori["pitch"]+" roll="+ori["roll"] +
                "lng="+pos["longitude"]+" lat="+pos["latitude"]+" elev="+pos["elevation"];
        var out = "{\n"+
                "   \"Type\": 0,\n"+
                "   \"BaseScore\": " + document.getElementById('basescore').value + ",\n"+
                "   \"Title\": \"" + document.getElementById('title').value + "\",\n"+
                "   \"CorrectOption\": " + document.getElementById('correctoption').value + ",\n"+
                "   \"Options\": [\"" + document.getElementById('option1').value + "\", \""+document.getElementById('option2').value + "\", \""+document.getElementById('option3').value + "\", \""+document.getElementById('option4').value + "\"],\n"+
                "   \"Views\": [\n";
        for(var i = 0; i<m_views.length; i++){
            out = out + "       { \"longitude\": "+m_views[i].longitude+",\n        \"latitude\": "+m_views[i].latitude+",\n        \"elevation\": "+m_views[i].elevation+",\n " +
                    "       \"yaw\": "+m_views[i].yaw+",\n        \"pitch\": "+m_views[i].pitch+",\n        \"roll\": "+m_views[i].roll+"\n       }";
            if(i < m_views.length -1)
            {
                out = out + ",\n";
            }
        }
        out = out + "   \n]\n}";

        document.getElementById('output').innerHTML = out;
    }

    function OnResize(context)
    {
        //var scene = ogGetScene(context);
        //ogSetSize(scene, window.innerWidth/2,window.innerHeight);
        m_centerX = (window.innerWidth-350)/2;
        m_centerY = window.innerHeight/2;
        m_stage.setSize(window.innerWidth-350, window.innerHeight);
    }



</script>
</body>
</html>
